# -*- mode: shell-script -*-

set -eu

error_exit() {
  ${2+:} false && echo "${0##*/}: $2" 1>&2
  exit $1
}

print_and_exec() {
  PS4=$( (set -x; :) 2>&1 | sed 's/:$//')
  echo "${PS4}${*}" 1>&2
  "${@}"
}

asdf_update() {
  print_and_exec asdf plugin update --all
  asdf current | cut -d ' ' -f 1 | while read line; do
    print_and_exec asdf global "${line}" latest
  done
}

subcmd=$1

case "${subcmd}" in
    upgrade) asdf_update ;;
    *) error_exit "Not supported subcommand: ${subcmd}"
esac
